<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="AssemblyReferencesTT" BeforeTargets="Build;TransformOnBuild">
    <!-- Look for files to generate -->
    <ItemGroup>
      <AssemblyReferencesTT Include="@(None)" Condition="'%(None.Filename)%(None.Extension)' == 'AssemblyReferences.tt'"/>
		<ReferencesTT Include="@(None)" Condition="'%(None.Filename)%(None.Extension)' == 'References.tt'"/>
    </ItemGroup>

    <Error Condition="'@(AssemblyReferencesTT->Count())' == 0" Text="No AssemblyReferences.tt file(s) found" />
	  <Error Condition="'@(ReferencesTT->Count())' == 0" Text="No References.tt file(s) found" />

    <!-- A message for all to enjoy! -->
    <WriteLinesToFile File="@(AssemblyReferencesTT)"
      Lines="&lt;# /* AUTOGENERATED BY MSBUILD and Kern Herskind Nightingale */ #&gt;"
      Overwrite="true"
      Encoding="Unicode" />

	<!-- Output all assembly references with a HintPath -->
    <WriteLinesToFile File="@(AssemblyReferencesTT)"
      Lines="&lt;#@ assembly name=&quot;%28ProjectDir%29%(Reference.HintPath)&quot; #&gt;"
      Overwrite="false"
      Encoding="Unicode"
      Condition="'%(Reference.HintPath)' != ''" />

	  <!-- Output all project references. This could fail with custom naming/structure of build output dirs  -->
	  <WriteLinesToFile File="@(AssemblyReferencesTT)"
		Lines="&lt;#@ assembly name=&quot;%24%28ProjectDir%29%(ProjectReference.RelativeDir)bin\$(Configuration)\%(ProjectReference.Name).dll&quot; #&gt;"
		Overwrite="false"
		Encoding="Unicode"
		Condition="'%(ProjectReference.Name)' != ''" />

	  <!-- A message for all to enjoy! -->
	  <WriteLinesToFile File="@(ReferencesTT)"
	 Lines="&lt;# /* AUTOGENERATED BY MSBUILD and Kern Herskind Nightingale */ #&gt;"
	 Overwrite="true"
	 Encoding="Unicode" />

	  <!-- Output all assembly references without a HintPath -->
    <WriteLinesToFile File="@(ReferencesTT)"
      Lines="&lt;#@ assembly name=&quot;%(Reference.Identity)&quot; #&gt;"
      Overwrite="false"
      Encoding="Unicode"
      Condition="'%(Reference.HintPath)' == ''" />
	  
    <Message Text="Generating %(AssemblyReferencesTT.FullPath) and  %(ReferencesTT.FullPath)" Importance="high" />
  </Target>
</Project>